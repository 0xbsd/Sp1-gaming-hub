<!DOCTYPE html>
<html lang="en">
   
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZK Gaming Hub - Games Menu</title>
    <link rel="stylesheet" href="css/styles.css">
    <script src="js/auth-flow.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --secondary: #8b5cf6;
            --accent: #10b981;
            --error: #ef4444;
            --warning: #f59e0b;
            --dark: #0f172a;
            --dark-lighter: #1e293b;
            --dark-card: #334155;
            --text: #e2e8f0;
            --text-dim: #94a3b8;
            --border: #475569;
            --gradient: linear-gradient(135deg, var(--primary), var(--secondary));
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--dark);
            color: var(--text);
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }

        /* Animated Background */
        .bg-shapes {
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: -1;
            overflow: hidden;
        }

        .shape {
            position: absolute;
            border-radius: 50%;
            filter: blur(80px);
            animation: float 20s ease-in-out infinite;
        }

        .shape1 {
            width: 400px;
            height: 400px;
            background: rgba(99, 102, 241, 0.3);
            top: -200px;
            left: -200px;
        }

        .shape2 {
            width: 300px;
            height: 300px;
            background: rgba(139, 92, 246, 0.3);
            bottom: -150px;
            right: -150px;
            animation-delay: -10s;
        }

        .shape3 {
            width: 350px;
            height: 350px;
            background: rgba(16, 185, 129, 0.2);
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            animation-delay: -5s;
        }

        @keyframes float {
            0%, 100% {
                transform: translateY(0) rotate(0deg);
            }
            33% {
                transform: translateY(-30px) rotate(120deg);
            }
            66% {
                transform: translateY(30px) rotate(240deg);
            }
        }

        /* Header */
        .header {
            background: rgba(30, 41, 59, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border);
            padding: 1rem 2rem;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            background: var(--gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            text-decoration: none;
        }

        .user-section {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }

        .points-badge {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: var(--dark-card);
            padding: 0.5rem 1rem;
            border-radius: 2rem;
            border: 1px solid var(--border);
        }

        .points-value {
            font-weight: bold;
            color: var(--primary);
        }

        .btn-logout {
            padding: 0.5rem 1.5rem;
            background: transparent;
            border: 1px solid var(--border);
            border-radius: 0.5rem;
            color: var(--text);
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-logout:hover {
            border-color: var(--error);
            color: var(--error);
        }

        /* Main Container */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 3rem 2rem;
        }

        /* Hero Section */
        .hero {
            text-align: center;
            margin-bottom: 4rem;
        }

        .hero-title {
            font-size: 3rem;
            margin-bottom: 1rem;
            background: var(--gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: glow 3s ease-in-out infinite;
        }

        @keyframes glow {
            0%, 100% { filter: brightness(1); }
            50% { filter: brightness(1.2); }
        }

        .hero-subtitle {
            font-size: 1.2rem;
            color: var(--text-dim);
            margin-bottom: 2rem;
        }

        /* Quick Stats */
        .quick-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 3rem;
        }

        .stat-card {
            background: var(--dark-lighter);
            border: 1px solid var(--border);
            border-radius: 1rem;
            padding: 1.5rem;
            text-align: center;
            transition: all 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            border-color: var(--primary);
        }

        .stat-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 0.25rem;
        }

        .stat-label {
            font-size: 0.875rem;
            color: var(--text-dim);
        }

        /* Games Grid */
        .games-section {
            margin-bottom: 4rem;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .section-title {
            font-size: 2rem;
            font-weight: bold;
        }

        .filter-buttons {
            display: flex;
            gap: 0.5rem;
        }

        .filter-btn {
            padding: 0.5rem 1rem;
            background: var(--dark-card);
            border: 1px solid var(--border);
            border-radius: 0.5rem;
            color: var(--text);
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.875rem;
        }

        .filter-btn.active {
            background: var(--primary);
            border-color: var(--primary);
        }

        .filter-btn:hover:not(.active) {
            border-color: var(--primary);
        }

        .games-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 2rem;
        }

        .game-card {
            background: var(--dark-lighter);
            border: 2px solid var(--border);
            border-radius: 1rem;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            color: var(--text);
            display: block;
            position: relative;
        }

        .game-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--gradient);
            transform: scaleX(0);
            transform-origin: left;
            transition: transform 0.3s;
        }

        .game-card:hover {
            transform: translateY(-5px);
            border-color: var(--primary);
            box-shadow: 0 20px 40px rgba(99, 102, 241, 0.2);
        }

        .game-card:hover::before {
            transform: scaleX(1);
        }

        .game-image {
            height: 200px;
            background: var(--dark-card);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4rem;
            position: relative;
            overflow: hidden;
        }

        .game-badge {
            position: absolute;
            top: 1rem;
            right: 1rem;
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .badge-easy {
            background: rgba(16, 185, 129, 0.2);
            color: var(--accent);
        }

        .badge-medium {
            background: rgba(245, 158, 11, 0.2);
            color: var(--warning);
        }

        .badge-hard {
            background: rgba(239, 68, 68, 0.2);
            color: var(--error);
        }

        .game-info {
            padding: 1.5rem;
        }

        .game-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .game-description {
            color: var(--text-dim);
            font-size: 0.875rem;
            margin-bottom: 1rem;
            line-height: 1.5;
        }

        .game-stats {
            display: flex;
            justify-content: space-between;
            font-size: 0.875rem;
            color: var(--text-dim);
        }

        .game-stat {
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        /* Coming Soon Section */
        .coming-soon-section {
            text-align: center;
            padding: 4rem 2rem;
            background: var(--dark-lighter);
            border-radius: 1rem;
            border: 2px dashed var(--border);
        }

        .coming-soon-title {
            font-size: 2rem;
            margin-bottom: 1rem;
            color: var(--primary);
        }

        .coming-soon-description {
            color: var(--text-dim);
            margin-bottom: 2rem;
        }

        .btn-coming-soon {
            display: inline-block;
            padding: 0.75rem 2rem;
            background: var(--gradient);
            color: white;
            text-decoration: none;
            border-radius: 0.5rem;
            font-weight: 500;
            transition: all 0.3s;
        }

        .btn-coming-soon:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(99, 102, 241, 0.3);
        }

        /* Loading State */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 400px;
        }

        .loader {
            width: 50px;
            height: 50px;
            border: 3px solid var(--border);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .hero-title {
                font-size: 2rem;
            }

            .games-grid {
                grid-template-columns: 1fr;
            }

            .header-content {
                flex-wrap: wrap;
                gap: 1rem;
            }

            .quick-stats {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <!-- Animated Background -->
    <div class="bg-shapes">
        <div class="shape shape1"></div>
        <div class="shape shape2"></div>
        <div class="shape shape3"></div>
    </div>

    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <a href="/games" class="logo">
                <span>🎮</span>
                <span>ZK Gaming Hub</span>
            </a>
            <div class="user-section">
                <div class="points-badge">
                    <span>⭐</span>
                    <span class="points-value" id="userPoints">0</span>
                    <span>ZK Points</span>
                </div>
                <button class="btn-logout" onclick="logout()">Logout</button>
            </div>
        </div>
    </header>

    <!-- Main Container -->
    <div class="container">
        <!-- Hero Section -->
        <section class="hero">
            <h1 class="hero-title">Choose Your Challenge</h1>
            <p class="hero-subtitle">Master Zero-Knowledge proofs through interactive gaming experiences</p>
        </section>

        <!-- Quick Stats -->
        <section class="quick-stats">
            <div class="stat-card">
                <div class="stat-icon">🎮</div>
                <div class="stat-value" id="totalGames">0</div>
                <div class="stat-label">Games Played</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">🏆</div>
                <div class="stat-value" id="highScore">0</div>
                <div class="stat-label">Highest Score</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">⚡</div>
                <div class="stat-value" id="totalProofs">0</div>
                <div class="stat-label">Proofs Generated</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">🌟</div>
                <div class="stat-value" id="globalRank">#-</div>
                <div class="stat-label">Global Rank</div>
            </div>
        </section>

        <!-- Games Section -->
        <section class="games-section">
            <div class="section-header">
                <h2 class="section-title">Available Games</h2>
                <div class="filter-buttons">
                    <button class="filter-btn active" onclick="filterGames('all')">All</button>
                    <button class="filter-btn" onclick="filterGames('easy')">Easy</button>
                    <button class="filter-btn" onclick="filterGames('medium')">Medium</button>
                    <button class="filter-btn" onclick="filterGames('hard')">Hard</button>
                </div>
            </div>

            <div class="games-grid" id="gamesGrid">
                <!-- Games will be loaded here -->
                <div class="loading">
                    <div class="loader"></div>
                </div>
            </div>
        </section>

        <!-- Coming Soon Section -->
        <section class="coming-soon-section">
            <h2 class="coming-soon-title">🚀 More Games Coming Soon!</h2>
            <p class="coming-soon-description">
                Get ready for multiplayer battles, advanced ZK proofs, and tournament modes!
            </p>
            <a href="/coming-soon" class="btn-coming-soon">See What's Coming →</a>
        </section>
    </div>

    <script>
        // Game data with FIXED PATHS (no .html extension)
        const games = [
            {
                id: 'proof-puzzle',
                name: 'Proof Puzzle',
                icon: '🧩',
                description: 'Learn ZK concepts through interactive puzzles. Perfect for beginners!',
                difficulty: 'easy',
                playCount: localStorage.getItem('proof-puzzle-plays') || 0,
                bestScore: localStorage.getItem('proof-puzzle-best') || 0,
                path: '/proof-puzzle'  // FIXED: removed .html
            },
            {
                id: 'zk-sudoku',
                name: 'ZK Sudoku',
                icon: '🔢',
                description: 'Solve Sudoku puzzles and prove your solution without revealing it.',
                difficulty: 'medium',
                playCount: localStorage.getItem('zk-sudoku-plays') || 0,
                bestScore: localStorage.getItem('zk-sudoku-best') || 0,
                path: '/zk-sudoku'  // FIXED: removed .html
            },
            {
                id: 'memory-matrix',
                name: 'Memory Matrix',
                icon: '🧠',
                description: 'Test your memory skills with pattern matching and ZK proofs.',
                difficulty: 'medium',
                playCount: localStorage.getItem('memory-matrix-plays') || 0,
                bestScore: localStorage.getItem('memory-matrix-best') || 0,
                path: '/memory-matrix'  // FIXED: removed .html
            },
            {
                id: 'proof-racing',
                name: 'Proof Racing',
                icon: '🏁',
                description: 'Race against AI to generate proofs. Speed and accuracy matter!',
                difficulty: 'hard',
                playCount: localStorage.getItem('proof-racing-plays') || 0,
                bestScore: localStorage.getItem('proof-racing-best') || 0,
                path: '/proof-racing'  // FIXED: removed .html
            }
        ];

        // Check authentication
        function checkAuth() {
            const token = localStorage.getItem('zkGamingToken');
            if (!token) {
                window.location.href = '/login';
                return false;
            }
            return true;
        }

        // Load user data
        function loadUserData() {
            const user = JSON.parse(localStorage.getItem('zkUser') || '{}');
            document.getElementById('userPoints').textContent = user.zkPoints || 0;
            
            // Load stats from localStorage (simulated)
            let totalGames = 0;
            let highScore = 0;
            let totalProofs = 0;
            
            games.forEach(game => {
                totalGames += parseInt(game.playCount);
                highScore = Math.max(highScore, parseInt(game.bestScore));
            });
            
            totalProofs = Math.floor(totalGames * 2.5); // Simulated
            
            document.getElementById('totalGames').textContent = totalGames;
            document.getElementById('highScore').textContent = highScore;
            document.getElementById('totalProofs').textContent = totalProofs;
            
            // Simulated rank
            const rank = totalGames > 0 ? Math.max(1, 100 - totalGames * 5) : '-';
            document.getElementById('globalRank').textContent = `#${rank}`;
        }

        // Render games
        function renderGames(filter = 'all') {
            const grid = document.getElementById('gamesGrid');
            const filteredGames = filter === 'all' 
                ? games 
                : games.filter(game => game.difficulty === filter);
            
            grid.innerHTML = filteredGames.map(game => `
                <a href="${game.path}" class="game-card" onclick="trackGameClick('${game.id}')">
                    <div class="game-image">
                        ${game.icon}
                        <span class="game-badge badge-${game.difficulty}">${game.difficulty}</span>
                    </div>
                    <div class="game-info">
                        <h3 class="game-title">${game.name}</h3>
                        <p class="game-description">${game.description}</p>
                        <div class="game-stats">
                            <span class="game-stat">
                                <span>🎮</span>
                                <span>${game.playCount} plays</span>
                            </span>
                            <span class="game-stat">
                                <span>⭐</span>
                                <span>Best: ${game.bestScore}</span>
                            </span>
                        </div>
                    </div>
                </a>
            `).join('');
        }

        // Filter games
        function filterGames(difficulty) {
            // Update active button
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Render filtered games
            renderGames(difficulty);
        }

        // Track game clicks
        function trackGameClick(gameId) {
            const plays = parseInt(localStorage.getItem(`${gameId}-plays`) || 0);
            localStorage.setItem(`${gameId}-plays`, plays + 1);
        }

        // Logout
        function logout() {
            localStorage.removeItem('zkGamingToken');
            localStorage.removeItem('zkUser');
            localStorage.removeItem('succinctVerified');
            localStorage.removeItem('zkOnboardingComplete');
            window.location.href = '/login';
        }

        // Initialize
        if (checkAuth()) {
            loadUserData();
            renderGames();
        }

        // Basic error handling
        window.addEventListener('error', function(e) {
            console.error('Script error:', e.error);
        });

        // Handle missing functions gracefully
        function handleMissingAPI() {
            if (typeof zkAPI === 'undefined') {
                console.warn('API not available, using mock data');
                // Initialize mock API
            }
        }
    </script>
    <!-- Add this before closing </body> tag in all HTML files -->
<script>
// Global error handling
window.addEventListener('error', function(e) {
    console.error('Script error:', e.error);
    // Don't break the app on errors
});

// Handle missing API gracefully
if (typeof window !== 'undefined' && !window.zkAPI) {
    // Import the mock API
    import('./api/config.js').then(module => {
        window.zkAPI = module.mockAPI;
    }).catch(err => {
        console.warn('Failed to load API config, using fallback');
        // Fallback API
        window.zkAPI = {
            auth: {
                login: () => Promise.resolve({ success: true, data: { token: 'mock_token' } }),
                logout: () => Promise.resolve({ success: true })
            },
            user: {
                getProfile: () => Promise.resolve({ success: true, data: {} }),
                updateProfile: () => Promise.resolve({ success: true }),
                getStats: () => Promise.resolve({ success: true, data: {} }),
                getAchievements: () => Promise.resolve({ success: true, data: [] }),
                getGameHistory: () => Promise.resolve({ success: true, data: { sessions: [] } })
            },
            games: {
                submitScore: () => Promise.resolve({ success: true, data: {} })
            }
        };
    });
}

// Handle localStorage errors
function safeLocalStorage(key, value = null) {
    try {
        if (value === null) {
            return localStorage.getItem(key);
        } else {
            localStorage.setItem(key, value);
        }
    } catch (e) {
        console.warn('localStorage error:', e);
        return null;
    }
}

// Replace localStorage calls with safe version if needed
if (typeof window !== 'undefined' && !window.localStorage) {
    window.localStorage = {
        getItem: () => null,
        setItem: () => {},
        removeItem: () => {},
        clear: () => {}
    };
}
</script>
</body>
</html>