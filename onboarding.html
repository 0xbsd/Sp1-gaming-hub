<!DOCTYPE html>
<html lang="en">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZK Gaming Hub - Welcome Experience</title>
    <link rel="stylesheet" href="css/styles.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --secondary: #8b5cf6;
            --accent: #10b981;
            --error: #ef4444;
            --warning: #f59e0b;
            --dark: #0f172a;
            --dark-lighter: #1e293b;
            --dark-card: #334155;
            --text: #e2e8f0;
            --text-dim: #94a3b8;
            --border: #475569;
            --gradient: linear-gradient(135deg, var(--primary), var(--secondary), var(--accent));
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--dark);
            color: var(--text);
            line-height: 1.6;
            overflow-x: hidden;
            min-height: 100vh;
        }

        /* Animated Background */
        .animated-bg {
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: -1;
            background: var(--dark);
            overflow: hidden;
        }

        .floating-shape {
            position: absolute;
            border-radius: 50%;
            filter: blur(80px);
            opacity: 0.5;
            animation: float 20s ease-in-out infinite;
        }

        .shape-1 {
            width: 300px;
            height: 300px;
            background: var(--primary);
            top: -150px;
            left: -150px;
        }

        .shape-2 {
            width: 400px;
            height: 400px;
            background: var(--secondary);
            bottom: -200px;
            right: -200px;
            animation-delay: -5s;
        }

        .shape-3 {
            width: 250px;
            height: 250px;
            background: var(--accent);
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            animation-delay: -10s;
        }

        @keyframes float {
            0%, 100% { transform: translate(0, 0) scale(1); }
            33% { transform: translate(30px, -30px) scale(1.1); }
            66% { transform: translate(-20px, 20px) scale(0.9); }
        }

        /* Main Container */
        .onboarding-container {
            position: relative;
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Progress Bar */
        .progress-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: var(--dark-lighter);
            z-index: 1000;
        }

        .progress-bar {
            height: 100%;
            background: var(--gradient);
            transition: width 0.5s ease;
            box-shadow: 0 0 10px var(--primary);
        }

        /* Skip Button */
        .skip-button {
            position: fixed;
            top: 2rem;
            right: 2rem;
            padding: 0.5rem 1.5rem;
            background: transparent;
            border: 1px solid var(--text-dim);
            border-radius: 2rem;
            color: var(--text-dim);
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9rem;
        }

        .skip-button:hover {
            border-color: var(--text);
            color: var(--text);
        }

        /* Onboarding Step */
        .onboarding-step {
            display: none;
            animation: fadeIn 0.5s ease;
            width: 100%;
            max-width: 800px;
        }

        .onboarding-step.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Step 1: Welcome */
        .welcome-step {
            text-align: center;
        }

        .logo-animation {
            font-size: 5rem;
            margin-bottom: 2rem;
            animation: bounce 2s ease infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }

        .welcome-title {
            font-size: 3rem;
            margin-bottom: 1rem;
            background: var(--gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: glow 3s ease-in-out infinite;
        }

        @keyframes glow {
            0%, 100% { filter: brightness(1); }
            50% { filter: brightness(1.2); }
        }

        .welcome-subtitle {
            font-size: 1.5rem;
            color: var(--text-dim);
            margin-bottom: 3rem;
        }

        /* Step 2: User Type Selection */
        .user-types {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }

        .user-type-card {
            background: var(--dark-lighter);
            border: 2px solid var(--border);
            border-radius: 1rem;
            padding: 2rem;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .user-type-card:hover {
            border-color: var(--primary);
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(99, 102, 241, 0.3);
        }

        .user-type-card.selected {
            border-color: var(--accent);
            background: rgba(16, 185, 129, 0.1);
        }

        .type-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }

        .type-title {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
            color: var(--primary);
        }

        .type-description {
            color: var(--text-dim);
            font-size: 0.9rem;
        }

        /* Step 3: Interactive Demo */
        .demo-container {
            background: var(--dark-lighter);
            border: 2px solid var(--border);
            border-radius: 1rem;
            padding: 2rem;
            margin-top: 2rem;
        }

        .demo-visual {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            margin: 2rem 0;
            align-items: center;
        }

        .demo-box {
            background: var(--dark-card);
            border: 2px solid var(--border);
            border-radius: 0.5rem;
            padding: 1.5rem;
            text-align: center;
            transition: all 0.3s;
        }

        .demo-box.active {
            border-color: var(--primary);
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(99, 102, 241, 0.5);
        }

        .demo-arrow {
            text-align: center;
            font-size: 2rem;
            color: var(--accent);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.5; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.2); }
        }

        /* Step 4: Wallet Connection */
        .wallet-options {
            display: grid;
            gap: 1rem;
            margin-top: 2rem;
        }

        .wallet-button {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem 1.5rem;
            background: var(--dark-card);
            border: 2px solid var(--border);
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.3s;
            color: var(--text);
            text-decoration: none;
        }

        .wallet-button:hover {
            border-color: var(--primary);
            transform: translateX(5px);
        }

        .wallet-icon {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--dark-lighter);
            border-radius: 0.5rem;
            font-size: 1.5rem;
        }

        .wallet-info {
            flex: 1;
        }

        .wallet-name {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .wallet-description {
            font-size: 0.9rem;
            color: var(--text-dim);
        }

        /* Step 5: Profile Setup */
        .profile-form {
            background: var(--dark-lighter);
            border: 2px solid var(--border);
            border-radius: 1rem;
            padding: 2rem;
            margin-top: 2rem;
        }

        .avatar-section {
            text-align: center;
            margin-bottom: 2rem;
        }

        .avatar-preview {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: var(--gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            margin: 0 auto 1rem;
            position: relative;
            overflow: hidden;
        }

        .avatar-upload {
            position: absolute;
            bottom: 0;
            right: 0;
            background: var(--primary);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border: 3px solid var(--dark-lighter);
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--text);
        }

        .form-input {
            width: 100%;
            padding: 0.75rem 1rem;
            background: var(--dark-card);
            border: 2px solid var(--border);
            border-radius: 0.5rem;
            color: var(--text);
            font-size: 1rem;
            transition: all 0.3s;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        /* Step 6: Tutorial Game */
        .mini-game {
            background: var(--dark-lighter);
            border: 2px solid var(--border);
            border-radius: 1rem;
            padding: 2rem;
            margin-top: 2rem;
            text-align: center;
        }

        .game-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            max-width: 300px;
            margin: 2rem auto;
        }

        .game-tile {
            aspect-ratio: 1;
            background: var(--dark-card);
            border: 2px solid var(--border);
            border-radius: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        .game-tile:hover {
            border-color: var(--primary);
            transform: scale(1.05);
        }

        .game-tile.revealed {
            background: rgba(99, 102, 241, 0.2);
            border-color: var(--primary);
        }

        .game-tile.matched {
            background: rgba(16, 185, 129, 0.2);
            border-color: var(--accent);
            animation: matchPulse 0.5s ease;
        }

        @keyframes matchPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        /* Navigation Buttons */
        .nav-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-top: 3rem;
        }

        .btn {
            padding: 0.75rem 2rem;
            border: none;
            border-radius: 0.5rem;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(99, 102, 241, 0.3);
        }

        .btn-secondary {
            background: transparent;
            color: var(--text);
            border: 2px solid var(--border);
        }

        .btn-secondary:hover {
            border-color: var(--primary);
        }

        /* Success State */
        .success-animation {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 8rem;
            animation: successPop 1s ease;
            z-index: 1000;
        }

        @keyframes successPop {
            0% { transform: translate(-50%, -50%) scale(0) rotate(0deg); }
            50% { transform: translate(-50%, -50%) scale(1.2) rotate(180deg); }
            100% { transform: translate(-50%, -50%) scale(1) rotate(360deg); }
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .welcome-title {
                font-size: 2rem;
            }

            .user-types {
                grid-template-columns: 1fr;
            }

            .demo-visual {
                grid-template-columns: 1fr;
                gap: 2rem;
            }

            .demo-arrow {
                transform: rotate(90deg);
            }

            .skip-button {
                top: 1rem;
                right: 1rem;
            }
        }

        /* Tooltips */
        .tooltip {
            position: relative;
            display: inline-block;
            cursor: help;
        }

        .tooltip .tooltip-text {
            visibility: hidden;
            width: 200px;
            background: var(--dark-card);
            color: var(--text);
            text-align: center;
            border-radius: 0.5rem;
            padding: 0.5rem;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.875rem;
            border: 1px solid var(--border);
        }

        .tooltip:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }
    </style>
</head>
<body>
    <!-- Animated Background -->
    <div class="animated-bg">
        <div class="floating-shape shape-1"></div>
        <div class="floating-shape shape-2"></div>
        <div class="floating-shape shape-3"></div>
    </div>

    <!-- Progress Bar -->
    <div class="progress-container">
        <div class="progress-bar" id="progressBar" style="width: 16.66%"></div>
    </div>

    <!-- Skip Button -->
    <button class="skip-button" onclick="skipOnboarding()">Skip Tutorial</button>

    <!-- Main Container -->
    <div class="onboarding-container">
        <!-- Step 1: Welcome -->
        <div class="onboarding-step active" id="step1">
            <div class="welcome-step">
                <div class="logo-animation">üéÆ</div>
                <h1 class="welcome-title">Welcome to ZK Gaming Hub</h1>
                <p class="welcome-subtitle">
                    The future of gaming with Zero-Knowledge proofs
                </p>
                
                <div class="nav-buttons">
                    <button class="btn btn-primary" onclick="nextStep()">
                        <span>Let's Get Started</span>
                        <span>‚Üí</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Step 2: User Type Selection -->
        <div class="onboarding-step" id="step2">
            <div style="text-align: center; margin-bottom: 2rem;">
                <h2 style="font-size: 2.5rem; margin-bottom: 1rem;">What brings you here?</h2>
                <p style="color: var(--text-dim);">Choose your path to personalize your experience</p>
            </div>

            <div class="user-types">
                <div class="user-type-card" onclick="selectUserType('gamer', this)">
                    <div class="type-icon">üéØ</div>
                    <h3 class="type-title">I'm a Gamer</h3>
                    <p class="type-description">
                        Ready to play innovative ZK-powered games and compete globally
                    </p>
                </div>

                <div class="user-type-card" onclick="selectUserType('developer', this)">
                    <div class="type-icon">üë®‚Äçüíª</div>
                    <h3 class="type-title">I'm a Developer</h3>
                    <p class="type-description">
                        Want to build ZK games and learn SP1 technology
                    </p>
                </div>

                <div class="user-type-card" onclick="selectUserType('curious', this)">
                    <div class="type-icon">ü§î</div>
                    <h3 class="type-title">I'm Curious</h3>
                    <p class="type-description">
                        New to ZK and want to learn through interactive experiences
                    </p>
                </div>
            </div>

            <div class="nav-buttons">
                <button class="btn btn-secondary" onclick="previousStep()">
                    <span>‚Üê</span>
                    <span>Back</span>
                </button>
                <button class="btn btn-primary" onclick="nextStep()" disabled id="typeNextBtn">
                    <span>Continue</span>
                    <span>‚Üí</span>
                </button>
            </div>
        </div>

        <!-- Step 3: Interactive ZK Demo -->
        <div class="onboarding-step" id="step3">
            <div style="text-align: center; margin-bottom: 2rem;">
                <h2 style="font-size: 2.5rem; margin-bottom: 1rem;">What is Zero-Knowledge?</h2>
                <p style="color: var(--text-dim);">Let's see it in action!</p>
            </div>

            <div class="demo-container">
                <p style="text-align: center; margin-bottom: 2rem;">
                    Imagine you want to prove you know a password without revealing it...
                </p>

                <div class="demo-visual">
                    <div class="demo-box" id="demoBox1">
                        <div style="font-size: 2rem; margin-bottom: 0.5rem;">üîê</div>
                        <div style="font-weight: 600;">Your Secret</div>
                        <div style="color: var(--text-dim); font-size: 0.9rem; margin-top: 0.5rem;">
                            "supersecret123"
                        </div>
                    </div>

                    <div class="demo-arrow">‚Üí</div>

                    <div class="demo-box" id="demoBox2">
                        <div style="font-size: 2rem; margin-bottom: 0.5rem;">üîß</div>
                        <div style="font-weight: 600;">ZK Magic</div>
                        <div style="color: var(--text-dim); font-size: 0.9rem; margin-top: 0.5rem;">
                            Processing...
                        </div>
                    </div>

                    <div class="demo-arrow">‚Üí</div>

                    <div class="demo-box" id="demoBox3">
                        <div style="font-size: 2rem; margin-bottom: 0.5rem;">‚úÖ</div>
                        <div style="font-weight: 600;">Proof</div>
                        <div style="color: var(--text-dim); font-size: 0.9rem; margin-top: 0.5rem;">
                            "Yes, they know it!"
                        </div>
                    </div>
                </div>

                <div style="text-align: center; margin-top: 2rem;">
                    <button class="btn btn-primary" onclick="runDemo()">
                        <span>üöÄ</span>
                        <span>See the Magic</span>
                    </button>
                </div>
            </div>

            <div class="nav-buttons" style="margin-top: 2rem;">
                <button class="btn btn-secondary" onclick="previousStep()">
                    <span>‚Üê</span>
                    <span>Back</span>
                </button>
                <button class="btn btn-primary" onclick="nextStep()">
                    <span>Got it!</span>
                    <span>‚Üí</span>
                </button>
            </div>
        </div>

        <!-- Step 4: Wallet Connection -->
        <div class="onboarding-step" id="step4">
            <div style="text-align: center; margin-bottom: 2rem;">
                <h2 style="font-size: 2.5rem; margin-bottom: 1rem;">Connect Your Wallet</h2>
                <p style="color: var(--text-dim);">Join the decentralized gaming revolution</p>
            </div>

            <div class="wallet-options">
                <button class="wallet-button" onclick="connectWallet('metamask')">
                    <div class="wallet-icon">ü¶ä</div>
                    <div class="wallet-info">
                        <div class="wallet-name">MetaMask</div>
                        <div class="wallet-description">Connect with MetaMask wallet</div>
                    </div>
                </button>

                <button class="wallet-button" onclick="connectWallet('walletconnect')">
                    <div class="wallet-icon">üîó</div>
                    <div class="wallet-info">
                        <div class="wallet-name">WalletConnect</div>
                        <div class="wallet-description">Use any WalletConnect compatible wallet</div>
                    </div>
                </button>

                <button class="wallet-button" onclick="connectWallet('email')">
                    <div class="wallet-icon">üìß</div>
                    <div class="wallet-info">
                        <div class="wallet-name">Email Login</div>
                        <div class="wallet-description">No wallet? Continue with email</div>
                    </div>
                </button>
            </div>

            <div style="text-align: center; margin-top: 2rem; color: var(--text-dim); font-size: 0.9rem;">
                <span class="tooltip">
                    Why do I need a wallet? 
                    <span class="tooltip-text">
                        Wallets let you own your game assets and achievements as NFTs!
                    </span>
                </span>
            </div>

            <div class="nav-buttons">
                <button class="btn btn-secondary" onclick="previousStep()">
                    <span>‚Üê</span>
                    <span>Back</span>
                </button>
            </div>
        </div>

        <!-- Step 5: Profile Setup -->
        <div class="onboarding-step" id="step5">
            <div style="text-align: center; margin-bottom: 2rem;">
                <h2 style="font-size: 2.5rem; margin-bottom: 1rem;">Create Your Profile</h2>
                <p style="color: var(--text-dim);">Let's personalize your gaming experience</p>
            </div>

            <div class="profile-form">
                <div class="avatar-section">
                    <div class="avatar-preview" id="avatarPreview">
                        <span>üéÆ</span>
                        <div class="avatar-upload">
                            <span>üì∑</span>
                        </div>
                    </div>
                    <p style="color: var(--text-dim); font-size: 0.9rem;">Click to upload avatar</p>
                </div>

                <div class="form-group">
                    <label class="form-label" for="username">Username</label>
                    <input type="text" id="username" class="form-input" placeholder="Enter your gaming name" oninput="validateUsername(this)">
                    <p style="color: var(--text-dim); font-size: 0.875rem; margin-top: 0.5rem;">
                        This will be your unique identifier in games
                    </p>
                </div>

                <div class="form-group">
                    <label class="form-label" for="email">Email (Optional)</label>
                    <input type="email" id="email" class="form-input" placeholder="your@email.com">
                    <p style="color: var(--text-dim); font-size: 0.875rem; margin-top: 0.5rem;">
                        Get notified about tournaments and updates
                    </p>
                </div>

                <div class="form-group">
                    <label class="form-label">Preferred Game Types</label>
                    <div style="display: flex; gap: 1rem; flex-wrap: wrap; margin-top: 0.5rem;">
                        <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                            <input type="checkbox" name="gameType" value="puzzle">
                            <span>Puzzle</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                            <input type="checkbox" name="gameType" value="strategy">
                            <span>Strategy</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                            <input type="checkbox" name="gameType" value="racing">
                            <span>Racing</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                            <input type="checkbox" name="gameType" value="card">
                            <span>Card Games</span>
                        </label>
                    </div>
                </div>
            </div>

            <div class="nav-buttons">
                <button class="btn btn-secondary" onclick="previousStep()">
                    <span>‚Üê</span>
                    <span>Back</span>
                </button>
                <button class="btn btn-primary" onclick="nextStep()" id="profileNextBtn">
                    <span>Continue</span>
                    <span>‚Üí</span>
                </button>
            </div>
        </div>

        <!-- Step 6: Tutorial Game -->
        <div class="onboarding-step" id="step6">
            <div style="text-align: center; margin-bottom: 2rem;">
                <h2 style="font-size: 2.5rem; margin-bottom: 1rem;">Let's Play!</h2>
                <p style="color: var(--text-dim);">Complete this mini-game to earn your first ZK achievement</p>
            </div>

            <div class="mini-game">
                <h3 style="color: var(--primary); margin-bottom: 1rem;">Memory Match with ZK Proofs</h3>
                <p style="color: var(--text-dim); margin-bottom: 2rem;">
                    Match the pairs without revealing all cards - that's Zero-Knowledge!
                </p>

                <div class="game-grid" id="gameGrid">
                    <div class="game-tile" onclick="flipTile(0)">?</div>
                    <div class="game-tile" onclick="flipTile(1)">?</div>
                    <div class="game-tile" onclick="flipTile(2)">?</div>
                    <div class="game-tile" onclick="flipTile(3)">?</div>
                    <div class="game-tile" onclick="flipTile(4)">?</div>
                    <div class="game-tile" onclick="flipTile(5)">?</div>
                </div>

                <div style="margin-top: 2rem;">
                    <p style="font-size: 1.2rem;">
                        Moves: <span id="moveCount" style="color: var(--primary); font-weight: bold;">0</span>
                    </p>
                </div>
            </div>

            <div class="nav-buttons">
                <button class="btn btn-secondary" onclick="resetGame()">
                    <span>üîÑ</span>
                    <span>Reset</span>
                </button>
                <button class="btn btn-primary" onclick="completeOnboarding()" style="display: none;" id="completeBtn">
                    <span>Complete Onboarding</span>
                    <span>üéâ</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Success Animation -->
    <div class="success-animation" id="successAnimation" style="display: none;">üéâ</div>

    <script>
        // Onboarding State
        let onboardingState = {
            currentStep: 1,
            totalSteps: 6,
            userType: null,
            walletConnected: false,
            profileData: {
                username: '',
                email: '',
                avatar: 'üéÆ',
                gameTypes: []
            },
            gameState: {
                moves: 0,
                flipped: [],
                matched: [],
                tiles: ['üéØ', 'üéØ', 'üéÆ', 'üéÆ', 'üèÜ', 'üèÜ']
            }
        };

        // Shuffle game tiles
        function shuffleTiles() {
            const tiles = [...onboardingState.gameState.tiles];
            for (let i = tiles.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [tiles[i], tiles[j]] = [tiles[j], tiles[i]];
            }
            onboardingState.gameState.tiles = tiles;
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            shuffleTiles();
            updateProgress();
        });

        // Navigation
        function nextStep() {
            if (onboardingState.currentStep < onboardingState.totalSteps) {
                document.getElementById(`step${onboardingState.currentStep}`).classList.remove('active');
                onboardingState.currentStep++;
                document.getElementById(`step${onboardingState.currentStep}`).classList.add('active');
                updateProgress();
                
                // Special handling for certain steps
                if (onboardingState.currentStep === 3) {
                    setTimeout(() => runDemo(), 500);
                }
            }
        }

        function previousStep() {
            if (onboardingState.currentStep > 1) {
                document.getElementById(`step${onboardingState.currentStep}`).classList.remove('active');
                onboardingState.currentStep--;
                document.getElementById(`step${onboardingState.currentStep}`).classList.add('active');
                updateProgress();
            }
        }

        function updateProgress() {
            const progress = (onboardingState.currentStep / onboardingState.totalSteps) * 100;
            document.getElementById('progressBar').style.width = `${progress}%`;
        }

        // Step 2: User Type Selection
        function selectUserType(type, element) {
            onboardingState.userType = type;
            
            // Update UI
            document.querySelectorAll('.user-type-card').forEach(card => {
                card.classList.remove('selected');
            });
            element.classList.add('selected');
            
            // Enable next button
            document.getElementById('typeNextBtn').disabled = false;
        }

        // Step 3: Interactive Demo
        function runDemo() {
            const boxes = ['demoBox1', 'demoBox2', 'demoBox3'];
            
            boxes.forEach((boxId, index) => {
                setTimeout(() => {
                    const box = document.getElementById(boxId);
                    box.classList.add('active');
                    
                    if (index === 1) {
                        // Show processing animation
                        const content = box.querySelector('div:last-child');
                        let dots = 0;
                        const interval = setInterval(() => {
                            dots = (dots + 1) % 4;
                            content.textContent = 'Processing' + '.'.repeat(dots);
                        }, 500);
                        
                        setTimeout(() => {
                            clearInterval(interval);
                            content.textContent = 'Proof Generated!';
                        }, 2000);
                    }
                    
                    if (index === 2) {
                        setTimeout(() => {
                            box.style.borderColor = 'var(--accent)';
                            box.style.background = 'rgba(16, 185, 129, 0.1)';
                        }, 500);
                    }
                }, index * 1000);
            });
        }

        // Step 4: Wallet Connection
        async function connectWallet(type) {
            const button = event.currentTarget;
            const originalContent = button.innerHTML;
            
            // Show loading state
            button.innerHTML = `
                <div class="wallet-icon">‚è≥</div>
                <div class="wallet-info">
                    <div class="wallet-name">Connecting...</div>
                    <div class="wallet-description">Please wait</div>
                </div>
            `;
            button.disabled = true;
            
            // Simulate wallet connection
            setTimeout(() => {
                onboardingState.walletConnected = true;
                
                // Show success
                button.innerHTML = `
                    <div class="wallet-icon">‚úÖ</div>
                    <div class="wallet-info">
                        <div class="wallet-name">Connected!</div>
                        <div class="wallet-description">0x1234...5678</div>
                    </div>
                `;
                button.style.borderColor = 'var(--accent)';
                button.style.background = 'rgba(16, 185, 129, 0.1)';
                
                // Auto-advance after success
                setTimeout(() => nextStep(), 1500);
            }, 2000);
        }

        // Step 5: Profile Setup
        function validateUsername(input) {
            const username = input.value.trim();
            const isValid = username.length >= 3 && username.length <= 20;
            
            if (isValid) {
                input.style.borderColor = 'var(--accent)';
                onboardingState.profileData.username = username;
                document.getElementById('profileNextBtn').disabled = false;
            } else {
                input.style.borderColor = username.length > 0 ? 'var(--error)' : 'var(--border)';
                document.getElementById('profileNextBtn').disabled = true;
            }
        }

        // Avatar selection
        const avatarOptions = ['üéÆ', 'üéØ', 'üèÜ', 'üé≤', 'üÉè', 'üöÄ', 'üåü', 'üíé'];
        let currentAvatarIndex = 0;

        document.addEventListener('DOMContentLoaded', () => {
            const avatarPreview = document.getElementById('avatarPreview');
            if (avatarPreview) {
                avatarPreview.addEventListener('click', () => {
                    currentAvatarIndex = (currentAvatarIndex + 1) % avatarOptions.length;
                    const newAvatar = avatarOptions[currentAvatarIndex];
                    avatarPreview.querySelector('span').textContent = newAvatar;
                    onboardingState.profileData.avatar = newAvatar;
                    
                    // Add rotation animation
                    avatarPreview.style.transform = 'rotate(360deg)';
                    setTimeout(() => {
                        avatarPreview.style.transform = 'rotate(0deg)';
                    }, 300);
                });
            }
        });

        // Step 6: Tutorial Game
        function flipTile(index) {
            const tiles = document.querySelectorAll('.game-tile');
            const tile = tiles[index];
            
            // Check if already flipped or matched
            if (onboardingState.gameState.flipped.includes(index) || 
                onboardingState.gameState.matched.includes(index)) {
                return;
            }
            
            // Flip the tile
            tile.classList.add('revealed');
            tile.textContent = onboardingState.gameState.tiles[index];
            onboardingState.gameState.flipped.push(index);
            
            // Check for match
            if (onboardingState.gameState.flipped.length === 2) {
                onboardingState.gameState.moves++;
                document.getElementById('moveCount').textContent = onboardingState.gameState.moves;
                
                const [first, second] = onboardingState.gameState.flipped;
                
                if (onboardingState.gameState.tiles[first] === onboardingState.gameState.tiles[second]) {
                    // Match found!
                    setTimeout(() => {
                        tiles[first].classList.add('matched');
                        tiles[second].classList.add('matched');
                        onboardingState.gameState.matched.push(first, second);
                        
                        // Check if game complete
                        if (onboardingState.gameState.matched.length === 6) {
                            gameComplete();
                        }
                    }, 500);
                } else {
                    // No match, flip back
                    setTimeout(() => {
                        tiles[first].classList.remove('revealed');
                        tiles[second].classList.remove('revealed');
                        tiles[first].textContent = '?';
                        tiles[second].textContent = '?';
                    }, 1000);
                }
                
                onboardingState.gameState.flipped = [];
            }
        }

        function resetGame() {
            onboardingState.gameState = {
                moves: 0,
                flipped: [],
                matched: [],
                tiles: ['üéØ', 'üéØ', 'üéÆ', 'üéÆ', 'üèÜ', 'üèÜ']
            };
            
            shuffleTiles();
            
            document.getElementById('moveCount').textContent = '0';
            document.querySelectorAll('.game-tile').forEach(tile => {
                tile.classList.remove('revealed', 'matched');
                tile.textContent = '?';
            });
            
            document.getElementById('completeBtn').style.display = 'none';
        }

        function gameComplete() {
            // Show success animation
            const successAnim = document.getElementById('successAnimation');
            successAnim.style.display = 'block';
            setTimeout(() => {
                successAnim.style.display = 'none';
            }, 1000);
            
            // Generate ZK proof of completion
            setTimeout(() => {
                const gameArea = document.querySelector('.mini-game');
                gameArea.innerHTML += `
                    <div style="margin-top: 2rem; padding: 1.5rem; background: rgba(16, 185, 129, 0.1); border: 2px solid var(--accent); border-radius: 0.5rem;">
                        <h4 style="color: var(--accent); margin-bottom: 0.5rem;">üéâ Congratulations!</h4>
                        <p>You completed the game in ${onboardingState.gameState.moves} moves!</p>
                        <p style="margin-top: 0.5rem; color: var(--text-dim); font-size: 0.9rem;">
                            A ZK proof has been generated to verify your achievement without revealing your moves!
                        </p>
                        <div style="margin-top: 1rem; font-family: monospace; font-size: 0.8rem; color: var(--primary);">
                            Proof: 0x7f3a9b2c...8d4e5f6a ‚úì
                        </div>
                    </div>
                `;
                
                document.getElementById('completeBtn').style.display = 'block';
            }, 1000);
        }

        // Complete Onboarding
        function completeOnboarding() {
            // Save user data
            const userData = {
                userType: onboardingState.userType,
                profile: onboardingState.profileData,
                walletConnected: onboardingState.walletConnected,
                tutorialCompleted: true,
                firstAchievement: {
                    name: 'First Steps',
                    description: 'Completed the onboarding tutorial',
                    zkPoints: 100
                }
            };
            
            // Show completion screen
            document.querySelector('.onboarding-container').innerHTML = `
                <div style="text-align: center; animation: fadeIn 0.5s ease;">
                    <div style="font-size: 6rem; margin-bottom: 2rem; animation: bounce 2s ease infinite;">üèÜ</div>
                    <h1 style="font-size: 3rem; margin-bottom: 1rem; background: var(--gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">
                        Welcome, ${userData.profile.username || 'Player'}!
                    </h1>
                    <p style="font-size: 1.5rem; color: var(--text-dim); margin-bottom: 3rem;">
                        You're ready to explore the world of ZK Gaming
                    </p>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 2rem; max-width: 600px; margin: 0 auto 3rem;">
                        <div style="background: var(--dark-lighter); padding: 2rem; border-radius: 1rem; border: 2px solid var(--border);">
                            <div style="font-size: 2rem; margin-bottom: 0.5rem;">üéÆ</div>
                            <div style="font-size: 1.5rem; color: var(--primary);">Level 1</div>
                            <div style="color: var(--text-dim);">Beginner</div>
                        </div>
                        <div style="background: var(--dark-lighter); padding: 2rem; border-radius: 1rem; border: 2px solid var(--border);">
                            <div style="font-size: 2rem; margin-bottom: 0.5rem;">‚≠ê</div>
                            <div style="font-size: 1.5rem; color: var(--primary);">100</div>
                            <div style="color: var(--text-dim);">ZK Points</div>
                        </div>
                        <div style="background: var(--dark-lighter); padding: 2rem; border-radius: 1rem; border: 2px solid var(--border);">
                            <div style="font-size: 2rem; margin-bottom: 0.5rem;">üèÖ</div>
                            <div style="font-size: 1.5rem; color: var(--primary);">1</div>
                            <div style="color: var(--text-dim);">Achievement</div>
                        </div>
                    </div>
                    
                    <button class="btn btn-primary" style="font-size: 1.2rem; padding: 1rem 3rem;" onclick="enterHub()">
                        <span>Enter Gaming Hub</span>
                        <span>üöÄ</span>
                    </button>
                </div>
            `;
            
            // Create confetti
            createConfetti();
        }

        // Skip onboarding
        function skipOnboarding() {
            if (confirm('Are you sure you want to skip the tutorial? You can always access it later from your profile.')) {
                enterHub();
            }
        }

        // Enter main hub
        function enterHub() {
            // Redirect to main gaming hub
            window.location.href = '/hub';
        }

        // Confetti effect
        function createConfetti() {
            const colors = ['#6366f1', '#8b5cf6', '#10b981', '#f59e0b', '#ef4444'];
            const confettiCount = 100;
            
            for (let i = 0; i < confettiCount; i++) {
                const confetti = document.createElement('div');
                confetti.style.position = 'fixed';
                confetti.style.width = Math.random() * 10 + 5 + 'px';
                confetti.style.height = confetti.style.width;
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.left = Math.random() * 100 + '%';
                confetti.style.top = '-10px';
                confetti.style.opacity = Math.random() + 0.5;
                confetti.style.transform = `rotate(${Math.random() * 360}deg)`;
                confetti.style.pointerEvents = 'none';
                confetti.style.zIndex = '9999';
                
                document.body.appendChild(confetti);
                
                // Animate falling
                const duration = Math.random() * 3 + 2;
                const delay = Math.random() * 2;
                
                confetti.style.animation = `confettiFall ${duration}s ${delay}s ease-out forwards`;
            }
            
            // Add animation keyframes
            if (!document.querySelector('#confettiStyle')) {
                const style = document.createElement('style');
                style.id = 'confettiStyle';
                style.textContent = `
                    @keyframes confettiFall {
                        to {
                            transform: translateY(calc(100vh + 20px)) rotate(720deg);
                            opacity: 0;
                        }
                    }
                `;
                document.head.appendChild(style);
            }
            
            // Clean up after animation
            setTimeout(() => {
                document.querySelectorAll('div[style*="confettiFall"]').forEach(el => el.remove());
            }, 7000);
        }

        // Add keyboard navigation
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.target.matches('input')) {
                const activeStep = document.querySelector('.onboarding-step.active');
                const primaryBtn = activeStep?.querySelector('.btn-primary:not([disabled])');
                if (primaryBtn) {
                    primaryBtn.click();
                }
            }
        });
    </script>
    
    const onboardingApiIntegration = `
<script src="/js/api.js"></script>
<script src="/js/auth.js"></script>
<script>
    // Override the completeOnboarding function to save to backend
    const originalCompleteOnboarding = completeOnboarding;
    
    completeOnboarding = async function() {
        // Save user data to backend
        const userData = {
            userType: onboardingState.userType,
            profile: onboardingState.profileData,
            walletConnected: onboardingState.walletConnected,
            tutorialCompleted: true,
            firstAchievement: {
                name: 'First Steps',
                description: 'Completed the onboarding tutorial',
                zkPoints: 100
            }
        };
        // Add to each HTML file that uses zkAPI
window.zkAPI = window.zkAPI || {
  auth: {
    login: () => Promise.resolve({ success: true }),
    logout: () => { localStorage.clear(); window.location.href = '/login'; }
  },
  user: {
    getProfile: () => Promise.resolve({ success: true, data: {} }),
    updateProfile: () => Promise.resolve({ success: true })
  }
};
        
        try {
            // Update user profile
            await zkAPI.user.updateProfile({
                username: userData.profile.username,
                email: userData.profile.email,
                avatar: userData.profile.avatar
            });
            
            // Save onboarding completion
            localStorage.setItem('onboardingCompleted', 'true');
            localStorage.setItem('userType', userData.userType);
            
            // Update user points (this would be done server-side in production)
            const user = getCurrentUser();
            if (user) {
                user.zkPoints = (user.zkPoints || 0) + 100;
                localStorage.setItem('zkUser', JSON.stringify(user));
            }
            
            // Call original completion function
            originalCompleteOnboarding();
        } catch (error) {
            console.error('Failed to save onboarding data:', error);
            // Still complete onboarding even if save fails
            originalCompleteOnboarding();
        }
    };
    // After onboarding completion
function completeOnboarding() {
    localStorage.setItem('zkOnboardingComplete', 'true');
    // Redirect to games hub
    window.location.href = '/games';
}
    // Update enterHub function to go to games page
    enterHub = function() {
        window.location.href = '/games';
    };
    // Basic error handling
window.addEventListener('error', function(e) {
  console.error('Script error:', e.error);
});

// Handle missing functions gracefully
function handleMissingAPI() {
  if (typeof zkAPI === 'undefined') {
    console.warn('API not available, using mock data');
    // Initialize mock API
  }
}
// In onboarding.html
document.addEventListener('DOMContentLoaded', () => {
    const hasCompletedOnboarding = localStorage.getItem('zkOnboardingComplete');
    
    if (hasCompletedOnboarding === 'true') {
        // User already onboarded, redirect to games
        window.location.href = '/games';
        return;
    }
    
    // Continue with onboarding...
    initializeOnboarding();
});
</script>
`;
</body>
</html>